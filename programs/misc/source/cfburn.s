; CFBURN.S
; COMPACT FLASH BURN-IN PROGRAM
; GAVIN TERSTEEG, 2024
; SDMAY24-14

; REQUIRES USE OF BIOS CALLS

; DEFINES
UART	=	0X90
UART_TH	=	UART+0X00
UART_LS	=	UART+0X05

.TEXT
	; START HERE
	; LET B BE OUR STRING POINTER 
START:	LOADI	B,STRING



	; PRINT A STRING TO THE CONSOLE
	; B = STRING TO PRINT
	; C = RETURN ADDRESS
	; USES: A, B, C
PRINT:	LOADF	A,[B]

	; MAKE SURE IT ISNT ZERO
	ADDI	A,0
	BRZ	1F
	
	; GET LINE STATUS REGISTER
0:	LOAD	C,[UART_LS]
	
	; READ 5TH BIT TO SEE IF WE CAN TRANSMIT YET
	SHIFTL	C
	SHIFTL	C
	SHIFTL	C
	BRNC	0B
	
	; TRANSMIT BYTE
	STORE	[UART_TH],A
	
	; INCREMENT POINTER
	ADDI	B,1
	
	; RETURN TO PRINT LOOP
	JUMP	PRINT
	
	; AND RETURN
1:	JUMPR	C
	


.DATA
.DEFL BYTE STRING	0x0A,0X0D,"I281 CF BURN-IN TEST",0X0A,0x0D,0
	