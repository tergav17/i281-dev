; ALLOC.S
; BLOCK ALLOCATION MANAGEMENT

	; FLUSH ANY BUFFERS THAT MAY HAVE BECOME DIRTY
	; ASSUMES WORK BANK IS SELECTED
	; USES: A, B, C, M0
FLUSH:	LOAD	A,[OF_DRTY]
	ADDI	A,0
	BRZ	0F
	
	; MOVE FILE SIZE BACK INTO FILE RECORD


	
0:	LOADI	A,WORK_B
	STORE	[DBANK],A
	JUMP	IRET
	
	; THE CURRENTLY OPEN FILE IS DIRTY
	; WRITE THE BLOCK TABLE AND UPDATE THE FILE RECORD

	; INDEX ALLOCATION BITMAP
	; SEARCHES FOR A BLOCK IN THE ALLOCATION TABLE
	; THAT CONTAINS AN EMPTY BLOCK
	; ASSUMES WORK BANK IS SELECTED
	; USES: A, B, C
AINDEX: