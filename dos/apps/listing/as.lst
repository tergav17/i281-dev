00/00:          ; DOSDEF.S
01/80:          ; THIS FILE CONTAINS IMPORTANT DEFINES USED IN DOS/281
01/80:          
01/80:          ; BIOS CALLS
01/80:          BOOT	= 0
01/80:          ALTBOOT = 1
01/80:          INDIR	= 2
01/80:          IRET	= 3
01/80:          SYSCALL	= 4
01/80:          SYSJUMP	= 5
01/80:          PRGM	= 6
01/80:          IWRITE	= 7
01/80:          ZSTART	= 8
01/80:          
01/80:          HALT	= 0X7F
01/80:          
01/80:          ; SYSTEM CALLS
01/80:          S_EXIT	= 0
01/80:          S_PUTC	= 1
01/80:          S_GETC	= 2
01/80:          S_STAT	= 3
01/80:          S_PUTS	= 4
01/80:          S_INPUT	= 5
01/80:          S_OPEN	= 6
01/80:          S_CLOSE	= 7
01/80:          S_READ	= 8
01/80:          S_WRITE	= 9
01/80:          S_FSRCH	= 10
01/80:          S_NEXT	= 11
01/80:          S_DELET	= 12
01/80:          S_CREAT	= 13
01/80:          S_FREE	= 14
01/80:          S_EXEC	= 15
01/80:          
01/80:          ; MEMORY AREAS
01/80:          CF_NAME	= 0X60
01/80:          CF_SIZE	= 0X68
01/80:          CF_USR	= 0X6A
01/80:          DFT_USR	= 0X6B
01/80:          ARG_BNK	= 0X6C
01/80:          BD_FREE	= 0X6E
01/80:          MAX_IB	= 0X70
01/80:          MAX_DB	= 0X71
01/80:          CMDL_B	= 0X72
01/80:          AUTO_B	= 0X73
01/80:          KERNMEM	= 0X78
01/80:          BIOSMEM	= 0X7C
01/80:          
01/80:          ; DATA BANK ADDRESS
01/80:          DBANK	= 0X80		
01/80:          
01/80:          
01/80:          ; AS0.S
01/80:          ; ASSEMBLER CORE
01/80:          ; GAVIN TERSTEEG, 2024
01/80:          ; SDMAY24-14
01/80:          
01/80:          ; BANK ALLOCATION STUFF
01/80:          BI	= 1
01/80:          BD	= 1
01/80:          
01/80:          ; MAXIMUM ARGUMENTS
01/80:          MAXARGS	= 15
01/80:          
01/80:          .TEXT
01/80:          .BANK	BI
01/80:          CORE0_B	= BI
01/80:          
01/80:          	; START BY PROCESSING THE ARGUMENTS
01/80: 3000     START:	LOADI	A,0
01/81: A080     	STORE	[DBANK],A
01/83:          	
01/82:          	; RESET ARG STATE
01/82: A000     	STORE	[ARGC],A
01/83: A011     	STORE	[LFLAG],A
01/85:          	
01/84:          	; SET UP STACK
01/84: 3C5E     	LOADI	D,0X60-2
01/86:          	
01/85:          	; SYSCALL RETURN BANK
01/85: 3801     	LOADI	C,1	
01/86: BB01     	STOREF	[D+1],C
01/88:          	
01/87:          	; SET UP POINTER
01/87: 3800     	LOADI	C,0
01/89:          	
01/88:          	; GO TO ARGUMENT BANK
01/88: 8072     0:	LOAD	A,[CMDL_B]
01/89: A06C     	STORE	[ARG_BNK],A
01/8A: A080     	STORE	[DBANK],A
01/8C:          
01/8B:          	; SKIP THE CURRENT ARGUMENT
01/8B: 9200     1:	LOADF	A,[C]
01/8C: 3420     	LOADI	B,0X20
01/8D: D100     	CMP	A,B
01/8E: F902     	BRBE	2F
01/8F: 5801     	ADDI	C,1
01/90: FFFA     	JUMP	1B
01/92:          
01/91:          	; LOOK FOR AN ARGUMENT
01/91: 9200     2:	LOADF	A,[C]
01/92: 5000     	ADDI	A,0
01/93: F62E     	BRZ	ARGDONE
01/94: D100     	CMP	A,B
01/95: F802     	BRA	3F
01/96: 5801     	ADDI	C,1
01/97: FFF9     	JUMP	2B
01/99:          
01/98:          	; IS IT A FLAG?
01/98: 342D     3:	LOADI	B,'-'
01/99: D100     	CMP	A,B
01/9A: F714     	BRNZ	5F
01/9C:          	
01/9B:          	; HANDLE FLAGS HERE	
01/9B: 5801     4:	ADDI	C,1
01/9C: 9200     	LOADF	A,[C]
01/9D: 5000     	ADDI	A,0
01/9E: F623     	BRZ	ARGDONE
01/9F: 3420     	LOADI	B,0X20
01/A0: D100     	CMP	A,B
01/A1: F9EF     	BRBE	2B
01/A3:          	
01/A2:          	; REGISTER THE FLAG
01/A2: 3400     	LOADI	B,0
01/A3: A480     	STORE	[DBANK],B
01/A5:          	
01/A4: 704C     	SUBI	A,'L'
01/A5: F701     	BRNZ	@+2
01/A6: 3411     	LOADI	B,LFLAG
01/A8:          	
01/A7:          	; IS IT A RECOGNIZED FLAG?
01/A7: 5400     	ADDI	B,0
01/A8: F60F     	BRZ	ARGBAD
01/A9: 3001     	LOADI	A,1
01/AA: B100     	STOREF	[B],A
01/AC:          
01/AB:          	; THERE MAY BE ANOTHER FLAG
01/AB: 8472     	LOAD	B,[CMDL_B]
01/AC: A46C     	STORE	[ARG_BNK],B
01/AD: A480     	STORE	[DBANK],B
01/AE: FFEC     	JUMP	4B
01/B0:          
01/AF:          	; SAVE THE ARGUMENT
01/AF: 3400     5:	LOADI	B,0
01/B0: A480     	STORE	[DBANK],B
01/B1: 8400     	LOAD	B,[ARGC]
01/B2: B901     	STOREF	[B+ARGV],C
01/B4:          	
01/B3:          	; DID WE EXCEED THE ALLOWED NUMBER OF ARGUMENTS
01/B3: 740F     	SUBI	B,MAXARGS
01/B4: F003     	BRC	ARGBAD
01/B5: 5410     	ADDI	B,MAXARGS+1
01/B6: A400     	STORE	[ARGC],B
01/B7: FFD0     	JUMP	0B
01/B9:          	
01/B8:          	; BAD ARGUMENT
01/B8: 3000     ARGBAD:	LOADI	A,0
01/B9: A080     	STORE	[DBANK],A
01/BB:          	
01/BA: 3001     	LOADI	A,ERR0_B
01/BB: A06C     	STORE	[ARG_BNK],A
01/BC: 3000     	LOADI	A,ERROR00
01/BE:          	
01/BD:          	; PRINT ERROR MESSAGE
01/BD: 3404     PRNTERR:LOADI	B,S_PUTS
01/BE: 38CC     	LOADI	C,EXIT
01/BF: FF44     	JUMP	SYSCALL	
01/C1:          
01/C0:          	; EXIT PROGRAM
01/C0: 3400     EXIT:	LOADI	B,0
01/C1: FF43     	JUMP	SYSJUMP
01/C3:          	
01/C2:          	; ARGUMENT PROCESSING DONE
01/C2: 3000     ARGDONE:LOADI	A,0
01/C3: A080     	STORE	[DBANK],A
01/C5:          	
01/C4:          	; CHECK ARG COUNT
01/C4: 8000     	LOAD	A,[ARGC]
01/C5: 5000     	ADDI	A,0
01/C6: F6F1     	BRZ	ARGBAD
01/C8:          	
01/C7:          	; RESET PASS TO FIRST
01/C7: 3000     	LOADI	A,0
01/C8: A025     	STORE	[PASS],A
01/CA:          	
01/C9:          	; BEGIN ASSEMBLY
01/C9: 3402     	LOADI	B,CORE1_B
01/CA: 3880     	LOADI	C,DOPASS
01/CB: FF36     	JUMP	INDIR
01/CD:          
01/CC:          	; EXIT PROGRAM
01/CC: 3400     EXIT:	LOADI	B,S_EXIT
01/CD: FF37     	JUMP	SYSJUMP
01/CF:          	
01/CE:          	; DO AN ERROR
01/CE: 3401     ERROR:	LOADI	B,BI
01/CF: B701     	STOREF	[D+1],B
01/D0: FFEC     	JUMP	PRNTERR
01/D2:          	
01/D1:          BI	= BI+1
01/D1:          .TEXT
01/D1:          .BANK	BI
02/80:          CORE1_B	= BI
02/80:          
02/80:          	; START A PASS
02/80:          	; BEGIN BY REWINDING THE SOURCE STREAM
02/80: 3802     DOPASS:	LOADI	C,BI
02/81: BB01     	STOREF	[D+1],C
02/82: 3887     	LOADI	C,@+5
02/83: BB00     	STOREF	[D],C
02/84: 3403     	LOADI	B,TOK0_B
02/85: 3883     	LOADI	C,REWIND
02/86: FF7B     	JUMP	INDIR
02/88:          
02/87:          	; TAKE IN A NEW LINE OF SOURCE CODE
02/87: 3802     ASMLINE:LOADI	C,BI
02/88: BB01     	STOREF	[D+1],C
02/89: 388E     	LOADI	C,@+5
02/8A: BB00     	STOREF	[D],C
02/8B: 3403     	LOADI	B,TOK0_B
02/8C: 3880     	LOADI	C,NEXTTOK
02/8D: FF74     	JUMP	INDIR
02/8F:          	
02/8E:          	; ARE WE AT THE END?
02/8E: 8012     	LOAD	A,[TOKEN]
02/8F: 5000     	ADDI	A,0
02/90: F7F6     	BRNZ	ASMLINE
02/92:          
02/91:          	; ALL DONE
02/91: 3401     ASMDONE:LOADI	B,CORE0_B
02/92: 38CC     	LOADI	C,EXIT
02/93: FF6E     	JUMP	INDIR
02/95:          
02/94:          
02/94:          	; ZERO BANK VARIABLES
02/94:          .BANK	0
00/80:          .BSS
00/80:          
00/00:          	; COMMAND LINE ARGUMENTS
00/00: 00       .DEFL BYTE ARGC		0
00/01: 00000000
       00000000 .DEFL BYTE ARGV		0,0,0,0,0,0,0,0,
00/09: 00000000
       00000000 			0,0,0,0,0,0,0,0
00/11:          
00/11:          	; COMMAND LINE FLAGS
00/11: 00       .DEFL BYTE LFLAG	0
00/12:          
00/12:          	; LATEST TOKEN
00/12: 00       .DEFL BYTE TOKEN	0
00/13:          
00/13:          	; TOKEN STREAM STATE
00/13: 00       .DEFL BYTE SRCINDX	0
00/14: 00       .DEFL BYTE SRCBLK	0
00/15: 00       .DEFL BYTE SRCBANK	0
00/16: 00       .DEFL BYTE SRCPNTR	0
00/17: 00       .DEFL BYTE SRCSTAT	0
00/18: 00       .DEFL BYTE SRCCHAR	0
00/19:          
00/19:          	; TOKEN BUFFER
00/19: 00       .DEFL BYTE BUFPNTR	0
00/1A: 00000000
       00000000
       0000     .DEFL BYTE TBUF		0,0,0,0,0,0,0,0,0,0
00/24: 00       .DEFL BYTE TBUFEND	0
00/25:          	
00/25:          	; ASSEMBLY STATE
00/25: 00       .DEFL BYTE PASS		0
00/26:          
00/26:          	; ERROR BANKS
00/26:          .BANK	BD
01/00:          .DATA
01/00:          ERR0_B	= BD
01/00:          
01/00:          	; ERROR MESSAGES
01/00: 494E5641
       4C494420
       41524755
       4D454E54
       530A0D   .DEFL BYTE ERROR00	"INVALID ARGUMENTS",0X0A,0X0D,
01/13: 55534147
       453A2041
       53205B2D
       4C5D2046
       494C4531
       2046494C
       4532202E
       2E2E0A0D
       00       			"USAGE: AS [-L] FILE1 FILE2 ...",0X0A,0X0D,0
01/34: 43414E27
       54204F50
       454E2046
       494C450A
       0D00     .DEFL BYTE ERROR01	"CAN'T OPEN FILE",0X0A,0X0D,0
01/46:          
01/46:          BD	= BD+1
01/46:          
01/46:          	; SOURCE READ BUFFER
01/46:          .BANK	BD
02/00:          .DATA
02/00:          SRC_B	= BD
02/00:          
02/00:          BD	= BD+4
02/00:          ; AS1.S
02/00:          ; SOURCE INPUT AND TOKENIZER
02/00:          ; GAVIN TERSTEEG, 2024
02/00:          ; SDMAY24-14
02/00:          
02/00:          ; NEW LINE CHARACTER
02/00:          NEWLINE	= 0X0A
02/00:          SEMICOL	= 0X3B
02/00:          SQUOTE	= 0X27
02/00:          DQUOTE	= 0X22
02/00:          SYMBOL	= 0X80
02/00:          NUMERIC	= 0X81
02/00:          
02/00:          
02/00:          BI	= BI+1
02/00:          .TEXT
02/94:          .BANK	BI
03/80:          TOK0_B	= BI
03/80:          
03/80:          	; GETS THE NEXT TOKEN
03/80:          	; TOKEN TYPE IS RETURNED IN [TOKEN]
03/80:          	; SPECIAL TYPES ARE:
03/80:          	; 'A' -> ALPHANUMERIC
03/80:          	; '0' -> NUMERIC
03/80:          	; NEWLINE -> NEW LINE
03/80:          	; ALL WHITESPACE IS IGNORED, UNLESS WE ARE INSIDE
03/80:          	; A STRING OR DEFINED CHAR
03/80:          	; 'A' AND '0' TOKENS WILL POPULATE THE TOKEN BUFFER
03/80:          	; AS WELL
03/80: 3404     NEXTTOK:LOADI	B,TOK1_B
03/81: 3880     	LOADI	C,NEXTTOA
03/82: FF7F     	JUMP	INDIR
03/84:          
03/83:          	; RESETS THE STATE OF THE TOKEN STREAM BACK TO
03/83:          	; BEGINNING OF SOURCE INPUT
03/83: 30FF     REWIND:	LOADI	A,0-1
03/84: A013     	STORE	[SRCINDX],A
03/86:          	
03/85:          	; SET FIRST CHAR AS INVALID
03/85: 3080     	LOADI	A,0X80
03/86: A018     	STORE	[SRCCHAR],A
03/88:          	
03/87:          	; GET THE NEXT FILE
03/87:          	; ALL POINTERS WILL BE RESET FOR FILE READ IN
03/87:          	; SRCINDX == ARGC IF WE ARE DONE READING IN BLOCK
03/87: 7C02     NEXTSRC:SUBI	D,2
03/89:          
03/88:          	; RESET POINTER, BLOCK, AND STAT
03/88: 3000     	LOADI	A,0
03/89: A016     	STORE	[SRCPNTR],A
03/8A: A014     	STORE	[SRCBLK],A
03/8B: A017     	STORE	[SRCSTAT],A
03/8D:          	
03/8C:          	; RESET BANK
03/8C: 3002     	LOADI	A,SRC_B
03/8D: A015     	STORE	[SRCBANK],A
03/8F:          
03/8E:          	; INCREMENT SOURCE INDEX
03/8E: 8013     0:	LOAD	A,[SRCINDX]
03/8F: 5001     	ADDI	A,1
03/90: A013     	STORE	[SRCINDX],A
03/92:          
03/91:          	; CHECK BOUNDS OF INDEX
03/91: 8400     	LOAD	B,[ARGC]
03/92: D100     	CMP	A,B
03/93: F019     	BRAE	9F
03/95:          	
03/94:          	; ATTEMPT TO OPEN FILE
03/94: 8472     	LOAD	B,[CMDL_B]
03/95: A46C     	STORE	[ARG_BNK],B
03/96: 9001     	LOADF	A,[A+ARGV]
03/97: 3803     	LOADI	C,BI
03/98: BB01     	STOREF	[D+1],C
03/99: 389B     	LOADI	C,@+2
03/9A: 3406     	LOADI	B,S_OPEN
03/9B: 389D     	LOADI	C,@+2
03/9C: FF67     	JUMP	SYSCALL
03/9D: 5000     	ADDI	A,0
03/9E: F606     	BRZ	1F
03/A0:          	
03/9F:          	; ERROR
03/9F: 3001     	LOADI	A,ERR0_B
03/A0: A06C     	STORE	[ARG_BNK],A
03/A1: 3034     	LOADI	A,ERROR01
03/A2: 3401     	LOADI	B,CORE0_B
03/A3: 38CE     	LOADI	C,ERROR
03/A4: FF5D     	JUMP	INDIR
03/A6:          
03/A5:          	; ATTEMPT TO READ THE FIRST BLOCK
03/A5: 3402     1:	LOADI	B,SRC_B
03/A6: A46C     	STORE	[ARG_BNK],B
03/A7: 3000     	LOADI	A,0
03/A8: 3408     	LOADI	B,S_READ
03/A9: 38AB     	LOADI	C,@+2
03/AA: FF59     	JUMP	SYSCALL
03/AC:          	
03/AB:          	; IF IT DIDN'T WORK, GET THE NEXT BLOCK
03/AB: 5000     	ADDI	A,0
03/AC: F7E1     	BRNZ	0B
03/AE:          
03/AD:          	; RETURN
03/AD: 5C02     9:	ADDI	D,2
03/AE: FF54     	JUMP	IRET
03/B0:          	
03/AF:          	; GET THE NEXT CHARACTER IN THE STREAM
03/AF:          	; RETURNS CHARACTER IN [SRCCHAR]
03/AF:          	; IF THERE ARE NO CHARACTER, 0 WILL BE RETURNED
03/AF: 7C02     NEXTCHR:SUBI	D,2
03/B1:          
03/B0:          	; CHECK SRCINDX != ARGC
03/B0: 8013     	LOAD	A,[SRCINDX]
03/B1: 8400     	LOAD	B,[ARGC]
03/B2: D100     	CMP	A,B
03/B3: F627     	BRZ	8F
03/B5:          
03/B4:          	; CHECK IF SRCPNTR IS VALID
03/B4: 8016     	LOAD	A,[SRCPNTR]
03/B5: 8415     	LOAD	B,[SRCBANK]
03/B6: 5000     	ADDI	A,0
03/B7: F40C     	BRN	3F
03/B9:          	
03/B8:          	; ALRIGHT, LETS JUST GRAB A CHARACTER FROM THE BANK
03/B8: A480     1:	STORE	[DBANK],B
03/B9: 9800     	LOADF	C,[A]
03/BA: 3400     	LOADI	B,0
03/BB: A480     	STORE	[DBANK],B
03/BD:          	
03/BC:          	; INCREMENT POINTER
03/BC: 5001     	ADDI	A,1
03/BD: A016     	STORE	[SRCPNTR],A
03/BF:          	
03/BE:          	; CAN WE RETURN?
03/BE: A818     2:	STORE	[SRCCHAR],C
03/BF: 5800     	ADDI	C,0
03/C0: F71C     	BRNZ	9F
03/C1: 380A     	LOADI	C,NEWLINE
03/C2: A818     	STORE	[SRCCHAR],C
03/C3: FF15     	JUMP	7F
03/C5:          	
03/C4:          	; INCREMENT BANK
03/C4: 3000     3:	LOADI	A,0
03/C5: 5401     	ADDI	B,1
03/C6: A415     	STORE	[SRCBANK],B
03/C7: 3806     	LOADI	C,SRC_B+4
03/C8: D600     	CMP	B,C
03/C9: F1EE     	BRB	1B
03/CB:          	
03/CA:          	; READ A NEW BLOCK
03/CA: 8014     	LOAD	A,[SRCBLK]
03/CB: 5001     	ADDI	A,1
03/CC: F00C     	BRC	7F
03/CD: A014     	STORE	[SRCBLK],A
03/CE: 3803     	LOADI	C,BI
03/CF: BB01     	STOREF	[D+1],C
03/D0: 3408     	LOADI	B,S_READ
03/D1: 38D3     	LOADI	C,@+2
03/D2: FF31     	JUMP	SYSCALL
03/D3: 5000     	ADDI	A,0
03/D4: F704     	BRNZ	7F
03/D6:          	
03/D5:          	; GO READ A CHARACTER NOW
03/D5: 3000     	LOADI	A,0
03/D6: 3402     	LOADI	B,SRC_B
03/D7: A415     	STORE	[SRCBANK],B
03/D8: FFDF     	JUMP	1B
03/DA:          
03/D9:          	; WE ARE DONE WITH THIS FILE
03/D9:          	; MOVE ON TO THE NEXT
03/D9: 5C02     7:	ADDI	D,2
03/DA: FFAC     	JUMP	NEXTSRC
03/DC:          	
03/DB:          	; STORE A ZERO IN SRCCHAR
03/DB: 3000     8:	LOADI	A,0
03/DC: A018     	STORE	[SRCCHAR],A
03/DE:          	
03/DD:          	; RETURN
03/DD: 5C02     9:	ADDI	D,2
03/DE: FF24     	JUMP	IRET
03/E0:          	
03/DF:          BI	= BI+1
03/DF:          .TEXT
03/DF:          .BANK	BI
04/80:          TOK1_B	= BI
04/80:          	
04/80:          	; SHADOW OF NEXTTOK
04/80: 7C02     NEXTTOA:SUBI	D,2
04/82:          
04/81:          	; SET RETURN ADDRESS
04/81: 3804     	LOADI	C,BI
04/82: BB01     	STOREF	[D+1],C
04/84:          
04/83:          	; CHECK THE NEXT CHARACTER IN THE STREAM
04/83: 8018     0:	LOAD	A,[SRCCHAR]
04/84: 5000     	ADDI	A,0
04/85: F668     	BRZ	8F
04/86: F43C     	BRN	5F
04/88:          
04/87:          	; IS IT A NEWLINE?
04/87: 340A     	LOADI	B,NEWLINE
04/88: D100     	CMP	A,B
04/89: F703     	BRNZ	1F
04/8B:          	
04/8A:          	; NEW LINE
04/8A: 3400     	LOADI	B,0
04/8B: A417     	STORE	[SRCSTAT],B
04/8C: FF61     	JUMP	8F
04/8E:          
04/8D:          	; CHECK STATE STUFF
04/8D: 8817     1:	LOAD	C,[SRCSTAT]
04/8E: 343B     	LOADI	B,SEMICOL
04/8F: D600     	CMP	B,C
04/90: F632     	BRZ	5F
04/91: 5800     	ADDI	C,0
04/92: F71A     	BRNZ	4F
04/94:          
04/93:          	; IS IT WHITESPACE?
04/93: 3420     	LOADI	B,0X20
04/94: D100     	CMP	A,B
04/95: F92D     	BRBE	5F
04/97:          	
04/96:          	; IS IT A NUMBER?
04/96: 3430     	LOADI	B,'0'
04/97: D100     	CMP	A,B
04/98: F105     	BRB	2F
04/99: 3439     	LOADI	B,'9'
04/9A: D100     	CMP	A,B
04/9B: F802     	BRA	2F
04/9D:          	
04/9C:          	; YEP
04/9C: 3481     	LOADI	B,NUMERIC
04/9D: FF2A     	JUMP	0F
04/9F:          	
04/9E:          	; NOPE, IS IT IS LETTER?
04/9E:          	; FIRST CONVERT FROM LOWERCASE TO UPPERCASE
04/9E: 3461     2:	LOADI	B,'A'+0X20
04/9F: D100     	CMP	A,B
04/A0: F104     	BRB	3F
04/A1: 347A     	LOADI	B,'Z'+0X20
04/A2: D100     	CMP	A,B
04/A3: F801     	BRA	3F
04/A4: 7020     	SUBI	A,0X20
04/A6:          	
04/A5:          	; CHECK FOR UPPER CASE LETTER
04/A5: 3441     3:	LOADI	B,'A'
04/A6: D100     	CMP	A,B
04/A7: F105     	BRB	4F
04/A8: 345A     	LOADI	B,'Z'
04/A9: D100     	CMP	A,B
04/AA: F802     	BRA	4F
04/AC:          	
04/AB:          	; YEP
04/AB: 3480     	LOADI	B,SYMBOL
04/AC: FF1B     	JUMP	0F
04/AE:          	
04/AD:          	; NOPE, PROCESS AS A LITERAL
04/AD: 8817     4:	LOAD	C,[SRCSTAT]
04/AE: D200     	CMP	A,C
04/AF: F703     	BRNZ	4F
04/B1:          	
04/B0:          	; END OF ENCLOSED SECTION
04/B0: 3800     	LOADI	C,0
04/B1: A817     	STORE	[SRCSTAT],C
04/B2: FF3B     	JUMP	8F
04/B4:          	
04/B3:          	; IF ENCLOSED, JUST SEND DIRECTLY TO OUTPUT
04/B3: 5800     4:	ADDI	C,0
04/B4: F739     	BRNZ	8F
04/B6:          
04/B5:          	; IS IT A COMMENT?
04/B5: 343B     	LOADI	B,SEMICOL
04/B6: D100     	CMP	A,B
04/B7: F702     	BRNZ	4F
04/B9:          	
04/B8:          	; SET COMMENT MODE
04/B8: A017     	STORE	[SRCSTAT],A
04/B9: FF09     	JUMP	5F
04/BB:          
04/BA:          	; IS IT A SINGLE OR DOUBLE QUOTE?
04/BA: 3427     4:	LOADI	B,SQUOTE
04/BB: D100     	CMP	A,B
04/BC: F604     	BRZ	4F
04/BD: 3422     	LOADI	B,DQUOTE
04/BE: D100     	CMP	A,B
04/BF: F601     	BRZ	4F
04/C0: FF2D     	JUMP	8F
04/C2:          
04/C1:          	; YES IT IS, SET THE STATE AND EXIT
04/C1: A017     4:	STORE	[SRCSTAT],A
04/C2: FF2B     	JUMP	8F
04/C4:          	
04/C3:          	; GRAB A NEW CHARACTER FROM THE STREAM
04/C3: 3883     5:	LOADI	C,0B
04/C4: BB00     	STOREF	[D],C
04/C5: 3403     	LOADI	B,TOK0_B
04/C6: 38AF     	LOADI	C,NEXTCHR
04/C7: FF3A     	JUMP	INDIR
04/C9:          
04/C8:          	; COPY THE SYMBOL OR NUMERIC INTO THE BUFFER
04/C8: A412     0:	STORE	[TOKEN],B
04/CA:          
04/C9:          	; PREPARE TO COPY
04/C9: 381A     	LOADI	C,TBUF
04/CB:          	
04/CA:          	; STORE CHARACTER
04/CA: B200     1:	STOREF	[C],A
04/CB: A819     	STORE	[BUFPNTR],C
04/CD:          
04/CC:          	; GET NEXT CHARACTER
04/CC: 38D1     2:	LOADI	C,@+5
04/CD: BB00     	STOREF	[D],C
04/CE: 3403     	LOADI	B,TOK0_B
04/CF: 38AF     	LOADI	C,NEXTCHR
04/D0: FF31     	JUMP	INDIR
04/D2:          	
04/D1:          	; CHECK CHARACTER TYPE
04/D1: 8819     	LOAD	C,[BUFPNTR]
04/D2: 8018     	LOAD	A,[SRCCHAR]
04/D4:          	
04/D3:          	; IS IT A NUMBER?
04/D3: 3430     	LOADI	B,'0'
04/D4: D100     	CMP	A,B
04/D5: F115     	BRB	7F
04/D6: 3439     	LOADI	B,'9'
04/D7: D100     	CMP	A,B
04/D8: F90D     	BRBE	4F
04/DA:          	
04/D9:          	; NOPE, IS IT IS LETTER?
04/D9:          	; FIRST CONVERT FROM LOWERCASE TO UPPERCASE
04/D9: 3461     	LOADI	B,'A'+0X20
04/DA: D100     	CMP	A,B
04/DB: F104     	BRB	3F
04/DC: 347A     	LOADI	B,'Z'+0X20
04/DD: D100     	CMP	A,B
04/DE: F801     	BRA	3F
04/DF: 7020     	SUBI	A,0X20
04/E1:          	
04/E0:          	; CHECK FOR UPPER CASE LETTER
04/E0: 3441     3:	LOADI	B,'A'
04/E1: D100     	CMP	A,B
04/E2: F108     	BRB	7F
04/E3: 345A     	LOADI	B,'Z'
04/E4: D100     	CMP	A,B
04/E5: F805     	BRA	7F
04/E7:          	
04/E6:          	; ADD TO THE STRING
04/E6: 5801     4:	ADDI	C,1
04/E7: 3424     	LOADI	B,TBUFEND
04/E8: D600     	CMP	B,C
04/E9: F6E2     	BRZ	2B
04/EA: FFDF     	JUMP	1B
04/EC:          	
04/EB:          	; TERMINATE
04/EB: 3000     7:	LOADI	A,0
04/EC: B201     	STOREF	[C+1],A
04/ED: FF03     	JUMP	9F
04/EF:          	
04/EE:          	; SAVE TOKEN TYPE AND CONSUME THE SRCCHAR
04/EE: 3480     8:	LOADI	B,0X80
04/EF: A418     	STORE	[SRCCHAR],B
04/F0: A012     	STORE	[TOKEN],A
04/F2:          	
04/F1:          	; RETURN
04/F1: 5C02     9:	ADDI	D,2
04/F2: FF10     	JUMP	IRET
04/F4:          	
