00/00:          ; DOSDEF.S
01/80:          ; THIS FILE CONTAINS IMPORTANT DEFINES USED IN DOS/281
01/80:          ; GAVIN TERSTEEG, 2024
01/80:          ; SDMAY24-14
01/80:          
01/80:          ; BIOS CALLS
01/80:          BOOT	= 0
01/80:          ALTBOOT = 1
01/80:          INDIR	= 2
01/80:          IRET	= 3
01/80:          SYSCALL	= 4
01/80:          SYSJUMP	= 5
01/80:          PRGM	= 6
01/80:          IWRITE	= 7
01/80:          ZSTART	= 8
01/80:          
01/80:          HALT	= 0X7F
01/80:          
01/80:          ; SYSTEM CALLS
01/80:          S_EXIT	= 0
01/80:          S_PUTC	= 1
01/80:          S_GETC	= 2
01/80:          S_STAT	= 3
01/80:          S_PUTS	= 4
01/80:          S_INPUT	= 5
01/80:          S_OPEN	= 6
01/80:          S_CLOSE	= 7
01/80:          S_READ	= 8
01/80:          S_WRITE	= 9
01/80:          S_FSRCH	= 10
01/80:          S_NEXT	= 11
01/80:          S_DELET	= 12
01/80:          S_CREAT	= 13
01/80:          S_FREE	= 14
01/80:          S_EXEC	= 15
01/80:          S_PRNTC	= 16
01/80:          S_PSTAT	= 17
01/80:          
01/80:          ; MEMORY AREAS
01/80:          CF_NAME	= 0X60
01/80:          CF_SIZE	= 0X68
01/80:          CF_USR	= 0X6A
01/80:          DFT_USR	= 0X6B
01/80:          ARG_BNK	= 0X6C
01/80:          BD_FREE	= 0X6E
01/80:          MAX_IB	= 0X70
01/80:          MAX_DB	= 0X71
01/80:          CMDL_B	= 0X72
01/80:          AUTO_B	= 0X73
01/80:          KERNMEM	= 0X78
01/80:          BIOSMEM	= 0X7C
01/80:          AU_RUN	= 0X00
01/80:          AU_PNTR	= 0X01
01/80:          AU_BANK	= 0X02
01/80:          AU_BLK	= 0X03
01/80:          AU_UA	= 0X04
01/80:          AU_FILE	= 0X06
01/80:          AU_MISC	= 0X18
01/80:          
01/80:          ; DATA BANK ADDRESS
01/80:          DBANK	= 0X80		
01/80:          
01/80:          
01/80:          ; CAT.S
01/80:          ; TYPE OUT FILES ONTO THE CONSOLE
01/80:          ; GAVIN TERSTEEG, 2024
01/80:          ; SDMAY24-14
01/80:          
01/80:          ; MAXIMUM ARGUMENTS
01/80:          MAXARGS	= 15
01/80:          
01/80:          	; START BY PROCESSING THE ARGUMENTS
01/80: 3000     START:	LOADI	A,0
01/81: A080     	STORE	[DBANK],A
01/83:          	
01/82:          	; RESET ARG STATE
01/82: A000     	STORE	[ARGC],A
01/83: A012     	STORE	[ARGMNT],A
01/85:          	
01/84:          	; SET UP STACK
01/84: 3C5E     	LOADI	D,0X60-2
01/86:          	
01/85:          	; SYSCALL RETURN BANK
01/85: 3801     	LOADI	C,1	
01/86: BB01     	STOREF	[D+1],C
01/88:          	
01/87:          	; SET UP FLAGS
01/87: 3800     	LOADI	C,0
01/88: A811     	STORE	[PFLAG],C
01/8A:          	
01/89:          	; GO TO ARGUMENT BANK
01/89: 8072     0:	LOAD	A,[CMDL_B]
01/8A: A06C     	STORE	[ARG_BNK],A
01/8B: A080     	STORE	[DBANK],A
01/8D:          
01/8C:          	; SKIP THE CURRENT ARGUMENT
01/8C: 9200     1:	LOADF	A,[C]
01/8D: 3420     	LOADI	B,0X20
01/8E: D100     	CMP	A,B
01/8F: F902     	BRBE	2F
01/90: 5801     	ADDI	C,1
01/91: FFFA     	JUMP	1B
01/93:          
01/92:          	; LOOK FOR AN ARGUMENT
01/92: 9200     2:	LOADF	A,[C]
01/93: 5000     	ADDI	A,0
01/94: F62E     	BRZ	ARGDONE
01/95: D100     	CMP	A,B
01/96: F802     	BRA	3F
01/97: 5801     	ADDI	C,1
01/98: FFF9     	JUMP	2B
01/9A:          
01/99:          	; IS IT A FLAG?
01/99: 342D     3:	LOADI	B,'-'
01/9A: D100     	CMP	A,B
01/9B: F714     	BRNZ	5F
01/9D:          	
01/9C:          	; HANDLE FLAGS HERE	
01/9C: 5801     4:	ADDI	C,1
01/9D: 9200     	LOADF	A,[C]
01/9E: 5000     	ADDI	A,0
01/9F: F623     	BRZ	ARGDONE
01/A0: 3420     	LOADI	B,0X20
01/A1: D100     	CMP	A,B
01/A2: F9EF     	BRBE	2B
01/A4:          	
01/A3:          	; REGISTER THE FLAG
01/A3: 3400     	LOADI	B,0
01/A4: A480     	STORE	[DBANK],B
01/A6:          	
01/A5: 7050     	SUBI	A,'P'
01/A6: F701     	BRNZ	@+2
01/A7: 3411     	LOADI	B,PFLAG
01/A9:          	
01/A8:          	; IS IT A RECOGNIZED FLAG?
01/A8: 5400     	ADDI	B,0
01/A9: F60F     	BRZ	ARGBAD
01/AA: 3001     	LOADI	A,1
01/AB: B100     	STOREF	[B],A
01/AD:          
01/AC:          	; THERE MAY BE ANOTHER FLAG
01/AC: 8472     	LOAD	B,[CMDL_B]
01/AD: A46C     	STORE	[ARG_BNK],B
01/AE: A480     	STORE	[DBANK],B
01/AF: FFEC     	JUMP	4B
01/B1:          
01/B0:          	; SAVE THE ARGUMENT
01/B0: 3400     5:	LOADI	B,0
01/B1: A480     	STORE	[DBANK],B
01/B2: 8400     	LOAD	B,[ARGC]
01/B3: B901     	STOREF	[B+ARGV],C
01/B5:          	
01/B4:          	; DID WE EXCEED THE ALLOWED NUMBER OF ARGUMENTS
01/B4: 740F     	SUBI	B,MAXARGS
01/B5: F003     	BRC	ARGBAD
01/B6: 5410     	ADDI	B,MAXARGS+1
01/B7: A400     	STORE	[ARGC],B
01/B8: FFD0     	JUMP	0B
01/BA:          	
01/B9:          	; BAD ARGUMENT
01/B9: 3000     ARGBAD:	LOADI	A,0
01/BA: A080     	STORE	[DBANK],A
01/BC:          	
01/BB: 3001     	LOADI	A,STR_B
01/BC: A06C     	STORE	[ARG_BNK],A
01/BD: 3000     	LOADI	A,ERROR0
01/BF:          	
01/BE:          	; PRINT ERROR MESSAGE
01/BE: 3404     	LOADI	B,S_PUTS
01/BF: 38C1     	LOADI	C,@+2
01/C0: FF43     	JUMP	SYSCALL
01/C2:          
01/C1:          	; EXIT PROGRAM
01/C1: 3400     	LOADI	B,0
01/C2: FF42     	JUMP	SYSJUMP
01/C4:          	
01/C3:          	; ARGUMENT PROCESSING DONE
01/C3: 3000     ARGDONE:LOADI	A,0
01/C4: A080     	STORE	[DBANK],A
01/C6:          	
01/C5:          	; CHECK ARG COUNT
01/C5: 8000     	LOAD	A,[ARGC]
01/C6: 5000     	ADDI	A,0
01/C7: F6F1     	BRZ	ARGBAD
01/C9:          	
01/C8:          	; GO TO MAIN FUNCTION
01/C8: 3402     	LOADI	B,2
01/C9: 3880     	LOADI	C,MAIN
01/CA: FF37     	JUMP	INDIR
01/CC:          
01/CB:          .BANK	2
02/80:          .TEXT
02/80:          	
02/80:          	; MAIN FUNCTION
02/80: 3802     MAIN:	LOADI	C,2	
02/81: BB01     	STOREF	[D+1],C
02/83:          	
02/82:          	; WAIT FOR PRINTER TO BECOME READY
02/82: 8011     	LOAD	A,[PFLAG]
02/83: 5000     	ADDI	A,0
02/84: F610     	BRZ	0F
02/86:          	
02/85: 3000     	LOADI	A,0
02/86: A016     PRTWAIT:STORE	[WAIT],A
02/88:          	
02/87:          	; GET PRINTER STATUS
02/87: 3411     	LOADI	B,S_PSTAT
02/88: 388A     	LOADI	C,@+2
02/89: FF7A     	JUMP	SYSCALL
02/8A: 5000     	ADDI	A,0
02/8B: F709     	BRNZ	0F
02/8D:          	
02/8C:          	; INCREMENT WAIT
02/8C: 8016     	LOAD	A,[WAIT]
02/8D: 5000     	ADDI	A,0
02/8E: F7F7     	BRNZ	PRTWAIT
02/90:          	
02/8F:          	; ERROR!
02/8F: 3001     	LOADI	A,STR_B
02/90: A06C     	STORE	[ARG_BNK],A
02/91: 3042     	LOADI	A,ERROR2
02/93:          	
02/92:          	; PRINT ERROR MESSAGE
02/92: 3404     	LOADI	B,S_PUTS
02/93: 38D4     	LOADI	C,EXIT
02/94: FF6F     	JUMP	SYSCALL
02/96:          	
02/95:          	; A = FILE STRING START
02/95: 8072     0:	LOAD	A,[CMDL_B]
02/96: A06C     	STORE	[ARG_BNK],A
02/97: 8012     	LOAD	A,[ARGMNT]
02/98: 9001     	LOADF	A,[A+ARGV]
02/9A:          	
02/99:          	; OPEN FILE
02/99: 3406     	LOADI	B,S_OPEN
02/9A: 389C     	LOADI	C,@+2
02/9B: FF68     	JUMP	SYSCALL
02/9D:          	
02/9C:          	; CHECK FOR ERRORS
02/9C: 5000     	ADDI	A,0
02/9D: F606     	BRZ	1F
02/9F:          	
02/9E:          	; ERROR MESSAGE ARGS
02/9E: 3001     	LOADI	A,STR_B
02/9F: A06C     	STORE	[ARG_BNK],A
02/A0: 3030     	LOADI	A,ERROR1
02/A2:          	
02/A1:          	; PRINT ERROR MESSAGE
02/A1: 3404     	LOADI	B,S_PUTS
02/A2: 38D4     	LOADI	C,EXIT
02/A3: FF60     	JUMP	SYSCALL
02/A5:          	
02/A4:          	; RESET STATE
02/A4: 3002     1:	LOADI	A,2
02/A5: A06C     	STORE	[ARG_BNK],A
02/A6: 3000     	LOADI	A,0
02/A8:          	
02/A7:          	; READ BLOCK
02/A7: A013     READF:	STORE	[COUNT],A
02/A8: 3408     	LOADI	B,S_READ
02/A9: 38AB     	LOADI	C,@+2
02/AA: FF59     	JUMP	SYSCALL
02/AC:          	
02/AB:          	; CHECK FOR ERRORS
02/AB: 5000     	ADDI	A,0
02/AC: F71F     	BRNZ	NEXT
02/AE:          	
02/AD:          	; SET DEFAULT POINTER AND BANK
02/AD: 3000     	LOADI	A,0
02/AE: 3402     	LOADI	B,2
02/B0:          	
02/AF:          	; LOOP TO OUTPUT CHARACTER
02/AF: A014     OUTPUT:	STORE	[POINTER],A
02/B0: A415     	STORE	[BANK],B 
02/B1: A480     	STORE	[DBANK],B
02/B2: 9000     	LOADF	A,[A]
02/B4:          	
02/B3:          	; MAKE SURE IT ISN'T 0
02/B3: 5000     	ADDI	A,0
02/B4: F617     	BRZ	NEXT
02/B6:          	
02/B5:          	; RETURN TO BANK ZERO
02/B5: 3400     	LOADI	B,0
02/B6: A480     	STORE	[DBANK],B
02/B8:          	
02/B7:          	; GET PFLAG
02/B7: 8411     	LOAD	B,[PFLAG]
02/B8: 5400     	ADDI	B,0
02/B9: F603     	BRZ	1F
02/BB:          	
02/BA:          	; PRINT CHARACTER
02/BA: 3410     	LOADI	B,S_PRNTC
02/BB: 38C0     	LOADI	C,2F
02/BC: FF47     	JUMP	SYSCALL
02/BE:          	
02/BD:          	; TYPE CHARACTER
02/BD: 3401     1:	LOADI	B,S_PUTC
02/BE: 38C0     	LOADI	C,@+2
02/BF: FF44     	JUMP	SYSCALL
02/C1:          	
02/C0:          	; NEXT CHARACTER
02/C0: 8014     2:	LOAD	A,[POINTER]
02/C1: 8415     	LOAD	B,[BANK]
02/C2: 5001     	ADDI	A,1
02/C3: F5EB     	BRNN	OUTPUT
02/C4: 3000     	LOADI	A,0
02/C5: 5401     	ADDI	B,1
02/C6: 3806     	LOADI	C,6
02/C7: D600     	CMP	B,C
02/C8: F7E6     	BRNZ	OUTPUT
02/CA:          	
02/C9:          	; NEXT BLOCK
02/C9: 8013     	LOAD	A,[COUNT]
02/CA: 5001     	ADDI	A,1
02/CB: F1DB     	BRNC	READF
02/CD:          	
02/CC:          	; NEXT FILE
02/CC: 3400     NEXT:	LOADI	B,0
02/CD: A480     	STORE	[DBANK],B
02/CE: 8012     	LOAD	A,[ARGMNT]
02/CF: 5001     	ADDI	A,1
02/D0: A012     	STORE	[ARGMNT],A
02/D1: 8400     	LOAD	B,[ARGC]
02/D2: D100     	CMP	A,B
02/D3: F7C1     	BRNZ	0B
02/D5:          
02/D4:          	; EXIT PROGRAM
02/D4: 3400     EXIT:	LOADI	B,0
02/D5: FF2F     	JUMP	SYSJUMP
02/D7:          
02/D6:          
02/D6:          .BANK	1
01/CB:          .DATA
01/00:          STR_B	= 1
01/00:          
01/00:          	; ERROR MESSAGES
01/00: 494E5641
       4C494420
       41524755
       4D454E54
       530A0D   .DEFL BYTE ERROR0	"INVALID ARGUMENTS",0X0A,0X0D,
01/13: 55534147
       453A2043
       41542046
       494C4531
       2046494C
       4532202E
       2E2E0A0D
       00       			"USAGE: CAT FILE1 FILE2 ...",0X0A,0X0D,0
01/30: 43414E27
       54204F50
       454E2046
       494C450A
       0D00     .DEFL BYTE ERROR1	"CAN'T OPEN FILE",0X0A,0X0D,0
01/42: 5052494E
       54455220
       4E4F5420
       52454144
       590A0D00 .DEFL BYTE ERROR2	"PRINTER NOT READY",0X0A,0X0D,0
01/56:          
01/56:          .BANK	0
00/00:          .BSS
00/00:          
00/00:          	; COMMAND LINE ARGUMENTS
00/00: 00       .DEFL BYTE ARGC		0
00/01: 00000000
       00000000 .DEFL BYTE ARGV		0,0,0,0,0,0,0,0,
00/09: 00000000
       00000000 			0,0,0,0,0,0,0,0
00/11:          			
00/11:          	; FLAGS
00/11: 00       .DEFL BYTE PFLAG	0
00/12:          
00/12:          	; ARGUMENT COUNTER
00/12: 00       .DEFL BYTE ARGMNT	0
00/13:          
00/13:          	; READ BLOCK COUNTER
00/13: 00       .DEFL BYTE COUNT	0
00/14:          
00/14:          	; INFORMATION ON WHAT CHARACTER IS BEING PRINTED
00/14: 00       .DEFL BYTE POINTER	0
00/15: 00       .DEFL BYTE BANK		0
00/16:          
00/16:          	; WAIT COUNT
00/16: 00       .DEFL BYTE WAIT		0
