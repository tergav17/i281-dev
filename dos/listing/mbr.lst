00/00:          ; MBR.S
01/80:          ; MASTER BOOT RECORD (2ND STAGE BOOTLOADER)
01/80:          
01/80:          ; DEFINES
01/80:          INDIR	= 0X01
01/80:          PRGM	= 0X02
01/80:          HALT	= 0X7F
01/80:          
01/80:          DBANK	=	0X80	; DATA BANK ADDRESS 
01/80:          CF	=	0XA0	; COMPACT FLASH BASE ADDRESS
01/80:          CF_DATA	=	CF+0X00	; CF DATA
01/80:          CF_ERR	=	CF+0X01	; CF ERROR
01/80:          CF_FEAT	=	CF+0x01	; CF FEATURES
01/80:          CF_CNT	=	CF+0X02	; CF SECTOR COUNT
01/80:          CF_LBA0	=	CF+0X03	; CF LBA BITS 0-7
01/80:          CF_LBA1	=	CF+0X04	; CF LBA BITS 8-15
01/80:          CF_LBA2	=	CF+0X05	; CF LBA BITS 16-23
01/80:          CF_LBA3	=	CF+0X06	; CF LBA BITS 24-27
01/80:          CF_STAT	=	CF+0X07	; CF STATUS
01/80:          CF_CMD	=	CF+0X07	; CF COMMAND
01/80:          
01/80:          .TEXT
01/80:          
01/80: FFFE     	JUMP	HALT
01/82:          
01/81:          	; WAIT FOR THE CF CARD TO BECOME READY
01/81:          	; FOR THIS TO HAPPEN, THE BUSY FLAG MUST BE 0
01/81:          	; AND THE READY FLAG MUST BE 1
01/81:          	; IF A CF CARD ISN'T PRESENT, THIS ROUTINE HANGS
01/81:          	; BUT WE DON'T CARE
01/81:          	; USES: A
01/81: 80A7     CFWAIT:	LOAD	A,[CF_STAT]
01/83:          
01/82:          	; CHECK BIT 7 (BUSY FLAG)
01/82: 4000     	SHIFTL	A
01/84:          	
01/83:          	; GO BACK TO START BUSY
01/83: F0FD     	BRC	CFWAIT
01/85:          	
01/84:          	; CHECK BIT 6 (READY FLAG)
01/84: 4000     	SHIFTL	A
01/86:          	
01/85:          	; GO BACK TO START IF NOT READY
01/85: F1FB     	BRNC	CFWAIT
01/87:          	
01/86:          	; RETURN FROM FUNCTION CALL
01/86: FE79     	JUMPR	C
01/88:          	
01/87:          
01/87:          
01/87:          .DATA
01/87:          
